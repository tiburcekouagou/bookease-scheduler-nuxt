rules_version='2'

service cloud.firestore {
  match /databases/{database}/documents {
    // USERS collection
    match /users/{userId} {
      allow read: if request.auth != null && request.auth.uid == userId; // only read own profile
      allow write: if request.auth != null && request.auth.uid == userId; // only update own profile
    }

    // BOOKINGS collection
    match /bookings/{bookingId} {
      allow create: if request.auth != null; // logged-in users can book
      allow read: if request.auth != null && (
        resource.data.customerId == request.auth.uid || // customer can see their bookings
        resource.data.tutorId == request.auth.uid       // tutor can see their bookings
      );
    }

    // SERVICES collection
    match /services/{serviceId} {
      allow read: if true; // everyone can see services
      allow create, update, delete: if request.auth != null && get(/databases/$(database)/documents/users/$(request.auth.uid)).data.role == "admin";
    }

    // DEFAULT - deny everything else
    match /{document=**} {
      allow read, write: if false;
    }
  }
}
